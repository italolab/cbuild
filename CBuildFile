
$version=1.0
$arch=x64

IF os == "windows"
    $so=windows
ENDIF
IF os != "windows"
    $so=linux
ENDIF

compiler=g++

IF os == "windows"
    output.file.name=cbuild.exe
ENDIF
IF os != "windows"
    output.file.name=cbuild
ENDIF

src.dir=src
test.dir=test
build.dir=build/cbuild-$(version)-$(so)-$(arch)

build.files=

$debug_bin_dir=bin/Debug
$debug_obj_dir=obj/Debug
$debug_compiler_params=-Wall -fexceptions -g -std=c++17
$debug_linker_params=

$release_bin_dir=bin/Release
$release_obj_dir=obj/Release
$release_compiler_params=-Wall -fexceptions -O2 -std=c++17
$release_linker_params=-s -static


bin.dir=$($(target)_bin_dir)
obj.dir=$($(target)_obj_dir)
compiler.params=$($(target)_compiler_params)
linker.params=$($(target)_linker_params)

lib.dirs=
include.dirs=
libs=

IF os != "windows"
    test.linker.params=-ldl -rdynamic
ENDIF

test.lib.dirs=lib/$(so)
test.include.dirs=include
test.libs=cbtest

task compile noverbose;

proc archive_and_copy_cbtest
    echo
    rm -r include/*.h
    rm lib/$(so)/libcbtest.a
    
    IF os == "windows"
        @.\cbuild.exe archivebuildall --script=../cbtest/CBuildFile-StaticLib
    ENDIF
    IF os != "windows"
        @./cbuild archivebuildall --script=../cbtest/CBuildFile-StaticLib
    ENDIF
    
    mkdir -p lib/$(so)

    cp -r ../cbtest/src/**/*.h include
<<<<<<< HEAD
    if os == "windows" then
        cp ../cbtest/build/cbtest-$(version)-$(so)-$(arch)/libcbtest.a lib/$(so)
    else
        cp ../cbtest/build/libcbtest.a lib/$(so)
    endif

=======
    cp ../cbtest/build/cbtest-$(version)-$(so)-$(arch)/libcbtest.a lib/$(so)
>>>>>>> 56a129944399025263be46fc24dfd2676bb254a0
    echo
endproc

task compileall before
   call archive_and_copy_cbtest
endtask

task compile before
    call archive_and_copy_cbtest
endtask

task finish after    

endtask